# ESP32 声音控制模块

这个项目实现了基于ESP32的声音控制功能，通过CAN总线接收情绪状态命令，控制不同GPIO引脚来触发外部音频设备播放不同的音效。

## 功能特点

- 使用ESP32的GPIO控制外部音频设备（通过继电器触发）
- 通过CAN总线接收情绪状态命令和木鱼敲击事件
- 支持五种不同音效：
  - 打雷闪电音效 (对应惊讶情绪)，通过GPIO23控制
  - 小雨点音效 (对应伤心情绪)，通过GPIO22控制
  - 木鱼敲击音效，通过GPIO19控制
  - 开心音效 (对应开心情绪)，通过GPIO18控制
  - 随机音效 (对应随机情绪)，通过GPIO17控制
- 智能防重复触发机制，处理3秒音频播放限制

## 硬件连接

- CAN总线: 
  - TX: GPIO5
  - RX: GPIO4
- 声音控制:
  - 打雷闪电音效: GPIO23 (低电平触发)
  - 小雨点音效: GPIO22 (低电平触发)
  - 木鱼敲击音效: GPIO19 (低电平触发)
  - 开心音效: GPIO18 (低电平触发)
  - 随机音效: GPIO17 (低电平触发)

## 情绪状态对应
- 开心(EMOTION_HAPPY=1): 触发开心音效
- 伤心(EMOTION_SAD=2): 触发小雨点音效
- 惊讶(EMOTION_SURPRISE=3): 触发打雷闪电音效
- 随机(EMOTION_RANDOM=4): 触发随机音效
- 木鱼敲击(WOODFISH_HIT=5): 触发木鱼敲击音效

## 防重复触发机制

为解决音频设备需要3秒完成播放的问题，本模块实现了智能防重复触发机制：
- 每个音效都有独立的状态跟踪和时间管理
- 当某个音效正在播放时，对该音效的重复触发会被自动忽略
- 系统会自动在3秒后释放音效控制引脚，准备接收下一次触发
- 日志系统会清晰显示音效播放和忽略状态

## 消息ID
- 0x789: 情绪状态命令ID
- 0x123: 木鱼敲击事件ID

## 开发环境

- 基于ESP-IDF框架
- 使用PlatformIO开发 