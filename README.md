# ESP32 CAN 测试系统

这是一个基于ESP32的CAN总线通信测试系统，用于控制LED灯光效果、电机、雾化器和检测木鱼敲击等功能。

## 项目组件

### 1. espcan-test-send

发送端ESP32设备，主要功能：
- 通过UART接收TouchDesigner的控制命令
- 将命令转发到CAN总线
- 支持LED、情绪效果、随机效果、电机和雾化器控制
- 检测木鱼敲击并发送事件通知

### 2. espcan-test-receiver

接收端ESP32设备，主要功能：
- 接收CAN命令并控制WS2812 LED灯带
- 实现三种情绪效果：彩虹(开心)、蓝色闪电(伤心)、紫色追逐(惊讶)
- 支持随机效果：流星雨和颜色爆炸效果

### 3. espcan-motor-pio

电机控制ESP32设备，主要功能：
- 接收CAN命令控制PWM输出
- 通过SSR(固态继电器)控制电机启停
- 向CAN总线发送状态确认消息

### 4. espcan-fogger

雾化器控制ESP32设备，主要功能：
- 接收CAN命令控制继电器开关
- 控制雾化器启停
- 向CAN总线发送状态确认消息

### 5. td-tester

Python上位机，模拟TouchDesigner：
- 提供图形界面控制各设备
- 通过串口发送控制命令
- 显示设备状态和木鱼敲击事件
- 支持LED、情绪、随机效果、电机和雾化器控制

## 通信协议

系统使用CAN总线进行设备间通信，消息ID如下：
- `0x456`: LED控制命令
- `0x789`: 情绪状态命令
- `0xABC`: 随机效果命令
- `0x301`: 电机控制命令
- `0x321`: 雾化器控制命令
- `0x123`: 木鱼敲击事件

## 构建与使用

各子项目均使用PlatformIO构建，请按照以下步骤操作：

1. 安装PlatformIO
2. 分别编译并上传各设备固件
3. 启动td-tester上位机
4. 通过上位机图形界面控制系统

## 硬件要求

- ESP32开发板 (每个功能至少一块)
- CAN收发器模块 (如TJA1050)
- WS2812 LED灯带
- 电机及驱动电路
- 继电器模块
- 木鱼敲击传感器

## 许可证

MIT 